<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
  <title>OrientaDiplomandi</title>

  <!-- Opzione rapida (CDN Google Fonts). Se usi content blocker, self-host qui sotto -->
  <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@300..800&display=swap" rel="stylesheet">

  <style>
    /* Self-host consigliato (metti il file in /fonts/). Mantieni anche il link GF come fallback se vuoi. */
    @font-face {
      font-family: "Merriweather Sans";
      src: url("/fonts/MerriweatherSans-VariableFont_wght.woff2") format("woff2");
      font-weight: 300 800;
      font-style: normal;
      font-display: block; /* evita rimpiazzi in stampa */
    }

    /* --- Impostazioni pagina --- */
    @page { size: A4; margin: 0; }

    html, body { background: #fff; }
    body {
      font-family: "Merriweather Sans", -apple-system, BlinkMacSystemFont, "Segoe UI",
                   Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Misure e paginazione affidabili */
    .page {
      width: 210mm;
      min-height: 297mm;
      box-sizing: border-box;
      margin: 0 auto;
      background: #fff;
    }

    /* Copertina: occupa esattamente A4 */
    .page-cover {
      height: 297mm;
      position: relative;
      overflow: hidden;
    }

    /* Media della copertina: STATICO, nessuna posizione absolute */
    .cover-media {
      display: block;
      width: 210mm;
      height: 297mm;
      object-fit: cover;
    }

    /* Pagina contenuti */
    .page-content {
      width: 210mm;
      min-height: 297mm;
      margin: 0 auto;
      background: #fff;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      box-sizing: border-box;
      overflow: visible;
      position: relative;
      page-break-after: always;
      box-shadow: 0 0 4mm rgba(0,0,0,0.1);
      border: none;
      line-height: 1.4;
      color: #111;
      -webkit-font-smoothing: antialiased;
    }

    /* --- STAMPA: regole dure per Chrome/iOS --- */
@media print {
  .page-content {
    box-shadow: none !important;
    width: 210mm !important;
    min-height: 297mm !important;
    margin: 0 !important;
    padding: 0 !important;
    background: #fff !important;
    overflow: visible !important;
    page-break-after: always !important;
    break-after: page !important;
    -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
  }

  /* evita bug di Chrome con object-fit: cover sugli <img> */
  .cover-media {
    display: block !important;
    width: 210mm !important;
    height: 297mm !important;
    object-fit: contain !important;  /* contain è più stabile in print */
    object-position: center center !important;
    background: none !important;
    visibility: visible !important;
  }
  
  /* assicurati che il contenitore non "nasconda" nulla */
  .page-cover {
    height: 297mm !important;
    overflow: visible !important;    
    -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
  }
  
  /* fallback: background statico */
  .page-cover.use-bg .cover-media { display: none !important; }
  .page-cover.use-bg {
    background-repeat: no-repeat !important;
    background-position: center center !important;
    background-size: contain !important;
  }

  /* iOS/Chrome: niente fixed/absolute in stampa */
  *[style*="position:fixed"], *[style*="position:absolute"] { position: static !important; }
  header, footer, .fixed, .sticky { position: static !important; }

  html, body { background: #fff !important; }

  /* Forza colori e font */
  * {
    -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
    font-family: "Merriweather Sans", -apple-system, BlinkMacSystemFont, "Segoe UI",
                 Roboto, "Helvetica Neue", Arial, sans-serif !important;
  }

  /* Ogni .page dopo la prima inizia su pagina nuova */
  .page + .page { page-break-before: always; break-before: page; }

  /* ✅ Layout risposte a colonne (Chrome ok, Safari ancora no) */
  .answers-list {
    display: block !important;
    column-count: 4 !important;
    column-gap: 8mm !important;
    width: 100% !important;
    margin: 0 !important;
  }
  .answers-list > li {
    display: inline-block !important;
    width: 100% !important;
    margin: 0 0 2mm 0 !important;
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }
  .answers-list [data-styled-border]{
    display:inline-block !important;
    min-width: 20mm;
    text-align: center;
  }

  /* Evita tagli interni */
  .card, .section, table, tr, img, svg, h2, h3, p {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }

  /* Ombre/transform alterano i box in stampa */
  [style*="transform"] { transform: none !important; }
  .shadow, [class*="shadow-"] { box-shadow: none !important; }

  /* --- questa riga DEVE STARE ALLA FINE --- */
  .grid:not(.answers-list):not(.layout-ok),
  .columns,
  [class*="grid-cols-"]:not(.answers-list):not(.layout-ok) {
    display: block !important;
  }
}
/* iOS/Safari only: stampa al ~78% */
@supports (-webkit-touch-callout: none) {
  @media print {
    /* Scala VISIVAMENTE ogni pagina (copertina + contenuti) */
    .page {
      transform: scale(0.78);
      transform-origin: top center;
    }

    /* Assicurati che lo spazio pagina non tagli nulla */
    .page, .page-content {
      overflow: visible !important;
    }

    /* Mantieni il salto pagina tra .page */
    .page + .page {
      page-break-before: always !important;
      break-before: page !important;
    }
  }
}

  

  </style>
</head>

<body>
  <!-- Pagina 1: Copertina (STATICA) -->
  <div class="page page-cover">
    <img src="copertina_restituzione.png" alt="Copertina Restituzione" class="cover-media">
  </div>

  <!-- Pagina 2: Contenuti -->
  <div class="page page-content p-[15mm]">
    <div class="bg-[#02356F] h-[60px] flex justify-between items-center px-5 text-white font-light">
      <h1>OrientaDiplomandi - Talents Venture</h1>
      <h1 id="data"></h1>
    </div>

    <div class="flex flex-col text-center mx-5 mt-5 font-semibold gap-3">
      <p class="text-xl">
        <span class="font-extrabold" id="fullName"></span>, da quanto emerso dalle tue risposte al questionario,
        il tuo stile prevalente* è il
      </p>
      <span id="stile" data-styled-text class="font-extrabold text-5xl"></span>
    </div>

    <div id="risposteDisplay" class="m-5 h-[250px] rounded-xl flex gap-2">
      <img id="stileImmagine" src="" alt="Illustrazione stile" class="size-[250px] rounded-l-xl">
      <div class="w-full m-[10px] p-2 flex flex-col items-center gap-1">
        <p data-styled-text class="font-bold text-xl mb-2">LE TUE RISPOSTE</p>
        <div data-styled-text class="w-full h-full" id="risposte"></div>
      </div>
    </div>

    <div class="h-[80px] mx-5 flex flex-row gap-3">
      <div class="border w-full rounded-lg bg-[#FFF5D1] border-[#E5B655] text-[#E5B655] text-center text-xl p-1">
        <p>COSTRUTTORE</p>
        <span id="valoreCreatore"></span>
      </div>
      <div class="border w-full rounded-lg bg-[#FFD2CE] border-[#821F43] text-[#821F43] text-center text-xl p-1">
        <p>CERCATORE</p>
        <span id="valoreCercatore"></span>
      </div>
      <div class="border w-full rounded-lg bg-[#CDE4FE] border-[#02356F] text-[#02356F] text-center text-xl p-1">
        <p>PLANNER</p>
        <span id="valorePianificatore"></span>
      </div>
    </div>

    <div class="m-5 flex-grow flex flex-col gap-2">
      <div class="p-2 flex flex-col gap-4">
        <p id="stileDescrizione" class="text-center"></p>
        <div class="flex flex-row gap-2">
          <div class="border border-green-600 w-1/2 rounded-lg p-2">
            <p class="mb-2 font-bold">Alcuni tuoi punti di forza:</p>
            <ul id="forza" class="list-disc pl-5 space-y-1 text-sm"></ul>
          </div>
          <div class="border border-red-600 w-1/2 rounded-lg p-2">
            <p class="mb-2 font-bold">Alcuni possibili ostacoli:</p>
            <ul id="debolezze" class="list-disc pl-5 space-y-1 text-sm"></ul>
          </div>
        </div>
      </div>

      <div class="flex-grow rounded-lg p-2 flex flex-col gap-4">
        <div>
          <p class="font-bold mb-2">Alcuni consigli per te:</p>
          <ul id="consigli" class="list-disc pl-5 space-y-1 text-sm"></ul>
        </div>
        <div>
          <p class="font-bold mb-2">Il percorso ideale per te:</p>
          <p id="predisposizione" class="text-sm"></p>
        </div>
      </div>

      <p class="font-light text-gray-400 text-[12px] leading-tight">
        I dati presentati in questo documento verranno poi presentati e spiegati durante il webinar da SalutePsy,
        ti invitiamo a conservare questo foglio.
        <br>*Ogni profilo prevede una combinazione, in percentuali diverse, dei tre stili.
      </p>
    </div>

    <div class="h-[60px] bg-[#02356F] flex px-5 text-white items-center justify-between">
      <div class="flex gap-5">
        <img src="Logo_sp_white.svg" alt="">
        <img src="logo_tv_white.svg" alt="">
      </div>
      <div class="text-[12px]">
        <p>www.salutepsy.it</p>
        <p>www.talentsventure.com</p>
      </div>
    </div>
  </div>

  <script>
    const STYLE_MAP = {
      CERCATORE: {
        bgClass: 'bg-[#FFCDC8]', textClass: 'text-[#821F43]',
        bgHex: '#FFCDC8', textHex: '#821F43', borderHex: '#821F43',
        img: 'img/cercatore.png',
        descrizione: '“La direzione giusta è quella che risuona con ciò che sei.”',
        forza: ["Creativo, curioso e aperto","Guida le scelte con valori ed emozioni autentiche","Sensibile e attento alle relazioni"],
        debolezze: ['Rischio di dispersione e indecisione','Vulnerabile all’ansia quando mancano riferimenti concreti','Può idealizzare senza verificare la realtà'],
        consigli: ["Traduci i tuoi valori in criteri concreti e osservabili","Usa micro-esperienze (stage, volontariato, progetti) per testare le scelte"],
        predisposizione: ['Ambiti dove contano identità e creatività: umanistico, artistico, sociale, comunicazione, psicologia, design.']
      },
      COSTRUTTORE: {
        bgClass: 'bg-[#FFF5D1]', textClass: 'text-[#E5B655]',
        bgHex: '#FFF5D1', textHex: '#E5B655', borderHex: '#E5B655',
        img: 'img/costruttore.png',
        descrizione: '“Agire è il modo più rapido per scoprire la strada.”',
        forza: ['Pragmatico e orientato al risultato','Impara facendo e decide rapidamente','Spirito di iniziativa e adattabilità'],
        debolezze: ['Rischio di impulsività e visione troppo breve','Difficoltà a fermarsi e riflettere','Tende a trascurare l’impatto emotivo delle scelte'],
        consigli: ["Inserisci momenti di verifica periodica per valutare effetti a medio termine","Confrontati con feedback esterni prima di scelte decisive"],
        predisposizione: ["Percorsi pratici, dinamici e tecnici: informatica, professioni tecniche, sanitarie operative, imprenditoria."]
      },
      PLANNER: {
        bgClass: 'bg-[#364F66]', textClass: 'text-[#CDE4FE]',
        bgHex: '#364F66', textHex: '#CDE4FE', borderHex: '#CDE4FE',
        img: 'img/planner.png',
        descrizione: '“Ogni passo è pensato, perché la sicurezza nasce dall’ordine.”',
        forza: ['Organizzato, metodico e preciso','Forte capacità di pianificazione e analisi','Affidabile e orientato agli obiettivi'],
        debolezze: ["Rischio di rigidità e perfezionismo","Paura di sbagliare → indecisione o ritardi","Fatica ad adattarsi agli imprevisti"],
        consigli: ["Fissa una deadline per fermare l’overthinking","Impara a tollerare piccole dosi di incertezza come palestra di flessibilità"],
        predisposizione: ["Facoltà e professioni con percorsi chiari e lineari: ingegneria, economia, medicina, professioni regolamentate."]
      }
    };

    function renderList(targetId, items = []) {
      const ul = document.getElementById(targetId);
      if (!ul) return;
      const nodes = (items||[]).filter(Boolean).map(t => {
        const li = document.createElement('li'); li.textContent = t; return li;
      });
      ul.replaceChildren(...nodes);
    }

    function applyDominantStyle(stileKey) {
      const cfg = STYLE_MAP[stileKey] || STYLE_MAP.COSTRUTTORE;

      // testi colorati
      document.querySelectorAll('[data-styled-text]').forEach(el => {
        Object.values(STYLE_MAP).forEach(s => el.classList.remove(s.textClass));
        el.classList.add(cfg.textClass);
        el.style.color = cfg.textHex; // fallback
      });

      // Bordi colorati
      document.querySelectorAll('[data-styled-border]').forEach(el => {
        el.style.borderColor = cfg.borderHex;
      });

      // box principale
      const box = document.getElementById('risposteDisplay');
      if (box) {
        Object.values(STYLE_MAP).forEach(s => box.classList.remove(s.bgClass));
        box.classList.add(cfg.bgClass);
        box.style.backgroundColor = cfg.bgHex; // fallback
      }

      // immagine
      const img = document.getElementById('stileImmagine');
      if (img) { img.src = cfg.img; img.alt = `Illustrazione stile ${stileKey}`; }

      // testi/lista
      document.getElementById('stileDescrizione')?.replaceChildren(cfg.descrizione);
      renderList('forza', cfg.forza);
      renderList('debolezze', cfg.debolezze);
      renderList('consigli', cfg.consigli);
      document.getElementById('predisposizione').replaceChildren(cfg.predisposizione);
    }

    function normalizeValues(results) {
      const v = {
        costruttore: Number(results?.costruttore ?? 0),
        cercatore:   Number(results?.cercatore   ?? 0),
        planner:     Number(results?.planner     ?? 0),
      };
      const s = Math.max(v.costruttore + v.cercatore + v.planner, 1);
      v.costruttore = Math.round(v.costruttore/s*100);
      v.cercatore   = Math.round(v.cercatore/s*100);
      v.planner     = 100 - v.costruttore - v.cercatore;
      return v;
    }

    document.addEventListener('DOMContentLoaded', () => {
      let state = {};
      try { state = JSON.parse(localStorage.getItem('od.state') || '{}'); } catch {}

      if (!state.user || !state.user.nome) { location.href = 'index.html'; return; }

      const values = normalizeValues(state.results || {});
      const dominanteKey = Object.entries(values).sort((a,b)=>b[1]-a[1])[0][0];
      const LABEL = { costruttore:'COSTRUTTORE', cercatore:'CERCATORE', planner:'PLANNER' };

      const fullName = [state.user.nome, state.user.cognome].filter(Boolean).join(' ');
      const today = new Date().toLocaleDateString('it-IT',{day:'2-digit',month:'2-digit',year:'numeric'});

      // Riempimento
      document.getElementById('fullName')?.replaceChildren(fullName);
      (document.getElementById('reportDate') || document.getElementById('data'))?.replaceChildren(today);
      document.getElementById('stile')?.replaceChildren(LABEL[dominanteKey] || '—');

      document.getElementById('valoreCreatore')?.replaceChildren(values.costruttore + '%');
      document.getElementById('valoreCercatore')?.replaceChildren(values.cercatore + '%');
      document.getElementById('valorePianificatore')?.replaceChildren(values.planner + '%');

      // Applica stile dominante
      const mapKey = LABEL[dominanteKey];
      applyDominantStyle(mapKey);

      // Lista risposte (4 colonne a schermo via grid; in stampa via columns)
      function orderAnswers(ans) {
        if (!ans) return [];
        if (Array.isArray(ans)) {
          return ans.map((v, i) => [i + 1, (v || '').toString().trim()]);
        }
        const entries = Object.entries(ans).map(([k, v]) => {
          const m = String(k).match(/\d+/);
          const idx = m ? parseInt(m[0], 10) : Number.isFinite(+k) ? +k : null;
          return [idx, (v || '').toString().trim()];
        }).filter(([i]) => i != null);
        entries.sort((a, b) => a[0] - b[0]);
        return entries;
      }

      function renderAnswersInline(containerId, ans) {
        const el = document.getElementById(containerId);
        if (!el) return;
        const list = orderAnswers(ans);

        const ol = document.createElement('ol');
        ol.className = 'answers-list text-sm leading-tight w-fit mx-auto';

        list.forEach(([i, v]) => {
          const li = document.createElement('li');
          li.innerHTML = `<span data-styled-border class="inline-block rounded-md px-2 py-0.5 border w-14 text-center">${i}.${String(v).toLowerCase()}</span>`;
          ol.appendChild(li);
        });

        el.replaceChildren(ol);
      }

      renderAnswersInline('risposte', state.answers || []);

      // Auto-stampa (opzionale da query ?auto=1)
      const params = new URLSearchParams(location.search);
      if (params.get('auto') === '1') {
        const closeAfterPrint = () => setTimeout(() => { try{ window.close(); }catch(e){} }, 200);
        window.addEventListener('afterprint', closeAfterPrint);
        const mql = window.matchMedia && window.matchMedia('print');
        if (mql && mql.addListener) mql.addListener(e => { if (!e.matches) closeAfterPrint(); });
        requestAnimationFrame(() => window.print());
      }
    });
  </script>
</body>
</html>





